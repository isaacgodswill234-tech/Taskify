
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>EarnHub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --bg-color: #0c0f16;
            --card-bg: #161b26;
            --text-main: #ffffff;
            --accent: #c0ff4d;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0; padding: 0;
            overflow-x: hidden;
            font-size: 13px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .nav-pill {
            background: rgba(22, 27, 38, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .card {
            background: var(--card-bg);
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        .btn-primary {
            background: var(--accent);
            color: #000;
            font-weight: 800;
            border-radius: 12px;
            padding: 12px;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            width: 100%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .btn-primary:active { transform: scale(0.96); }
        .btn-primary:disabled { opacity: 0.4; filter: grayscale(1); }

        .input-field {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 10px;
            padding: 10px 14px;
            color: white;
            outline: none;
            width: 100%;
            font-size: 12px;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide { animation: slideUp 0.3s ease-out forwards; }
        
        .compact-text { font-size: 11px; line-height: 1.4; }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyCpjvqewcoUF4YztK0YtmFhrI7e4H1-HOg",
            authDomain: "first-but.firebaseapp.com",
            databaseURL: "https://first-but-default-rtdb.firebaseio.com",
            projectId: "first-but",
            storageBucket: "first-but.firebasestorage.app",
            messagingSenderId: "114535930457",
            appId: "1:114535930457:web:3260229c6910745864af48"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const tg = window.Telegram?.WebApp;
        if(tg) {
            tg.ready();
            tg.expand();
        }

        const showToast = (msg, icon = "‚úÖ") => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-24 left-1/2 -translate-x-1/2 w-[85%] bg-white text-black p-3 rounded-xl flex items-center gap-3 shadow-2xl z-[10000] animate-slide font-bold text-[10px] uppercase';
            toast.innerHTML = `<span>${icon}</span> <span class="break-words">${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; toast.style.transition = '0.4s'; setTimeout(() => toast.remove(), 400); }, 4000);
        };

        const escapeHTML = (str) => {
            if (!str) return "";
            return str.toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
        };

        const PinModal = ({ title, onConfirm, onCancel }) => {
            const [pin, setPin] = useState('');
            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-md z-[3000] flex items-center justify-center p-6">
                    <div className="card w-full max-w-xs p-6 space-y-4">
                        <div className="text-center">
                            <h3 className="text-lg font-black uppercase italic tracking-tighter">{title}</h3>
                            <p className="text-[10px] text-slate-500 uppercase font-bold mt-1">Authentication Required</p>
                        </div>
                        <input type="password" className="input-field text-center text-xl tracking-[1em] h-14" placeholder="****" maxLength={6} value={pin} autoFocus onChange={e => setPin(e.target.value)} />
                        <div className="flex gap-2">
                            <button onClick={onCancel} className="flex-1 py-3 bg-white/5 rounded-xl font-bold text-[10px] uppercase">Cancel</button>
                            <button onClick={() => onConfirm(pin)} className="btn-primary flex-1">Enter</button>
                        </div>
                    </div>
                </div>
            );
        };

        const formatChannelId = (id) => {
            if (!id) return id;
            if (id.startsWith('@')) return id;
            if (!id.startsWith('-')) return `-100${id}`;
            return id;
        };

        const base64ToBlob = (base64) => {
            const parts = base64.split(',');
            const byteString = atob(parts[1]);
            const mimeString = parts[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) ia[i] = byteString.charCodeAt(i);
            return new Blob([ab], { type: mimeString });
        };

        const sendToTelegram = async (type, data, config) => {
            if (!config.botToken) throw new Error("Bot token missing in Dev Panel");
            const channelIdRaw = type === 'task' ? config.submissionChannelId : config.withdrawalChannelId;
            if (!channelIdRaw) throw new Error("Channel ID missing in Dev Panel");
            
            const channelId = formatChannelId(channelIdRaw);
            const baseAppUrl = `https://t.me/${config.botUsername}/${config.appShortName}`;
            
            let response;
            if (type === 'task') {
                const blob = base64ToBlob(data.proof);
                const formData = new FormData();
                formData.append('chat_id', channelId);
                formData.append('photo', blob, 'p.jpg');
                const keyboard = { inline_keyboard: [[{ text: "‚úÖ APPROVE", url: `${baseAppUrl}?startapp=apr_${data.uid}_${data.reward}` }, { text: "‚ùå DECLINE", url: `${baseAppUrl}?startapp=dec_${data.uid}` }]] };
                
                // Switch to HTML parse_mode to avoid Markdown character parsing issues (like underscores in names)
                const caption = `üìù <b>TASK PROOF</b>\nUser: @${escapeHTML(data.username)}\nTask: ${escapeHTML(data.taskTitle)}\nReward: ${data.reward} ${escapeHTML(config.currency)}\nUID: <code>${escapeHTML(data.uid)}</code>`;
                
                formData.append('caption', caption);
                formData.append('parse_mode', 'HTML');
                formData.append('reply_markup', JSON.stringify(keyboard));
                response = await fetch(`https://api.telegram.org/bot${config.botToken}/sendPhoto`, { method: 'POST', body: formData });
            } else {
                const keyboard = { inline_keyboard: [[{ text: "üí∞ PAID", url: `${baseAppUrl}?startapp=pyd_${data.uid}` }, { text: "üîô REFUND", url: `${baseAppUrl}?startapp=ref_${data.uid}_${data.amount}` }]] };
                
                const text = `üí∏ <b>WITHDRAWAL</b>\nUser: @${escapeHTML(data.username)}\nAmt: ${data.amount} ${escapeHTML(config.currency)}\nBank: ${escapeHTML(data.bankName)}\nAcc: <code>${escapeHTML(data.accountNumber)}</code>`;
                
                response = await fetch(`https://api.telegram.org/bot${config.botToken}/sendMessage`, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                        body: JSON.stringify({ 
                        chat_id: channelId, 
                        text, 
                        parse_mode: 'HTML', 
                        reply_markup: keyboard 
                    }) 
                });
            }

            const resData = await response.json();
            if (!resData.ok) throw new Error(resData.description || "Telegram API Error");
            return resData;
        };

        const TaskCard = ({ task, user, currency, config }) => {
            const [expanded, setExpanded] = useState(false);
            const [proof, setProof] = useState('');
            const [loading, setLoading] = useState(false);
            const isPending = user?.pendingTasks?.[task.id];
            
            const submit = async () => {
                if (!proof) return showToast("Add screenshot", "üì∑");
                setLoading(true);
                try {
                    await sendToTelegram('task', { uid: user.uid, username: user.username, taskId: task.id, taskTitle: task.title, reward: task.reward, proof: proof }, config);
                    await db.ref(`users/${user.uid}/pendingTasks/${task.id}`).set(true);
                    showToast("Sent for review!", "üöÄ");
                    setExpanded(false);
                    setProof('');
                } catch(e) { 
                    showToast(`TG ERR: ${e.message}`, "‚ùå"); 
                    console.error(e);
                } finally { setLoading(false); }
            };

            return (
                <div className="card mb-3 overflow-hidden bg-white/[0.02]">
                    <div onClick={() => !isPending && setExpanded(!expanded)} className={`p-3 flex items-center justify-between transition-colors ${isPending ? 'opacity-40 grayscale' : 'active:bg-white/5'}`}>
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-xl">{task.icon || '‚≠ê'}</div>
                            <div>
                                <h4 className="font-bold text-xs tracking-tight">{task.title}</h4>
                                <span className="text-[var(--accent)] font-bold text-[10px]">+{task.reward} {currency}</span>
                            </div>
                        </div>
                        {isPending ? (
                            <div className="text-[8px] font-black uppercase text-amber-500 bg-amber-500/10 px-2 py-1 rounded-md">Pending</div>
                        ) : (
                            <span className={`text-[10px] opacity-20 transition-transform ${expanded ? 'rotate-180' : ''}`}>‚ñº</span>
                        )}
                    </div>
                    {expanded && !isPending && (
                        <div className="px-3 pb-3 space-y-3 animate-slide">
                            <p className="compact-text text-slate-400">{task.description}</p>
                            {task.link && <button onClick={() => window.open(task.link, '_blank')} className="w-full py-2 bg-white/5 rounded-lg text-[10px] font-black border border-white/10 uppercase">Perform Action</button>}
                            <div className="relative h-32 bg-black/40 rounded-xl border-2 border-dashed border-white/10 flex flex-col items-center justify-center overflow-hidden">
                                <input type="file" accept="image/*" onChange={e => {
                                    const file = e.target.files[0];
                                    if(file) {
                                        const r = new FileReader();
                                        r.onload = ev => setProof(ev.target.result);
                                        r.readAsDataURL(file);
                                    }
                                }} className="absolute inset-0 opacity-0 z-10" />
                                {proof ? <img src={proof} className="w-full h-full object-cover" /> : <p className="text-[9px] uppercase font-black opacity-30">Tap to upload proof</p>}
                            </div>
                            <button disabled={loading || !proof} onClick={submit} className="btn-primary">
                                {loading ? 'SENDING...' : 'SUBMIT PROOF'}
                            </button>
                        </div>
                    )}
                    {isPending && config.publicSubmissions && (
                        <div className="px-3 pb-3">
                            <button onClick={() => window.open(`https://t.me/${config.publicSubmissions.replace('@', '')}`, '_blank')} className="w-full py-2 bg-amber-500/5 rounded-lg text-[9px] font-black border border-amber-500/10 text-amber-500 uppercase flex items-center justify-center gap-2">
                                üëÅÔ∏è View in Proofs Channel
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const DevPanel = ({ onExit, config }) => {
            const [settings, setSettings] = useState({ ...config });
            const save = async () => {
                await db.ref('config/app').update(settings);
                showToast("Dev Saved", "‚öôÔ∏è");
            };
            return (
                <div className="fixed inset-0 bg-[#080a11] p-5 z-[2000] overflow-y-auto no-scrollbar pb-10">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-lg font-black tracking-tighter uppercase italic">Developer Panel</h2>
                        <button onClick={onExit} className="bg-white/5 w-8 h-8 rounded-full flex items-center justify-center">‚úï</button>
                    </div>
                    <div className="space-y-4">
                        <div className="card p-4 space-y-3">
                            <p className="text-[9px] font-black text-slate-600 uppercase">PIN Management</p>
                            <input placeholder="Reset Developer PIN" className="input-field" value={settings.devPin || ''} onChange={e => setSettings({...settings, devPin: e.target.value})} />
                        </div>
                        <div className="card p-4 space-y-3">
                            <p className="text-[9px] font-black text-slate-600 uppercase">Telegram Master Config</p>
                            <input type="password" placeholder="Bot Token (e.g. 123:ABC)" className="input-field" value={settings.botToken || ''} onChange={e => setSettings({...settings, botToken: e.target.value})} />
                            <input placeholder="Bot Username (no @)" className="input-field" value={settings.botUsername || ''} onChange={e => setSettings({...settings, botUsername: e.target.value})} />
                            <input placeholder="App Short Name" className="input-field" value={settings.appShortName || ''} onChange={e => setSettings({...settings, appShortName: e.target.value})} />
                            <div className="p-3 bg-amber-500/10 rounded-lg text-[8px] text-amber-500 font-bold mb-2">Note: For numeric IDs, `-100` will be added automatically.</div>
                            <input placeholder="Submissions ID (Numeric or @)" className="input-field" value={settings.submissionChannelId || ''} onChange={e => setSettings({...settings, submissionChannelId: e.target.value})} />
                            <input placeholder="Payouts ID (Numeric or @)" className="input-field" value={settings.withdrawalChannelId || ''} onChange={e => setSettings({...settings, withdrawalChannelId: e.target.value})} />
                            <input placeholder="Public Sub Username (no @)" className="input-field" value={settings.publicSubmissions || ''} onChange={e => setSettings({...settings, publicSubmissions: e.target.value})} />
                            <input placeholder="Public Pay Username (no @)" className="input-field" value={settings.publicPayouts || ''} onChange={e => setSettings({...settings, publicPayouts: e.target.value})} />
                        </div>
                        <button onClick={save} className="btn-primary h-12">UPDATE INFRASTRUCTURE</button>
                    </div>
                </div>
            );
        };

        const AdminPanel = ({ onExit, config, tasks }) => {
            const [settings, setSettings] = useState({ ...config });
            const [newTask, setNewTask] = useState({ icon: 'üéØ', title: '', reward: 100, description: '', link: '' });
            const save = async () => {
                await db.ref('config/app').update(settings);
                showToast("Admin Saved", "üíæ");
            };
            return (
                <div className="fixed inset-0 bg-[#080a11] p-5 z-[1500] overflow-y-auto no-scrollbar pb-20">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-lg font-black tracking-tighter uppercase italic">Admin Hub</h2>
                        <button onClick={onExit} className="bg-white/5 w-8 h-8 rounded-full flex items-center justify-center">‚úï</button>
                    </div>
                    <div className="space-y-6">
                        <div className="card p-4 space-y-3">
                            <p className="text-[9px] font-black text-slate-600 uppercase">PIN Management</p>
                            <input placeholder="Reset Admin PIN" className="input-field" value={settings.adminPin || ''} onChange={e => setSettings({...settings, adminPin: e.target.value})} />
                        </div>
                        <div className="card p-4 space-y-3">
                            <p className="text-[9px] font-black text-slate-600 uppercase">App Settings</p>
                            <input placeholder="Custom App Name" className="input-field" value={settings.appName || ''} onChange={e => setSettings({...settings, appName: e.target.value})} />
                            <div className="grid grid-cols-2 gap-2">
                                <input type="number" placeholder="Min Withdrawal" className="input-field" value={settings.minWithdrawal || ''} onChange={e => setSettings({...settings, minWithdrawal: Number(e.target.value)})} />
                                <input type="number" placeholder="Invite Reward" className="input-field" value={settings.referralReward || ''} onChange={e => setSettings({...settings, referralReward: Number(e.target.value)})} />
                            </div>
                        </div>
                        <div className="card p-4 space-y-3">
                            <p className="text-[9px] font-black text-slate-600 uppercase">Mandatory Join Sequence</p>
                            {[1, 2, 3].map(i => (
                                <div key={i} className="space-y-1">
                                    <input placeholder={`Channel ${i} Label`} className="input-field" value={settings[`chan${i}Name`] || ''} onChange={e => setSettings({...settings, [`chan${i}Name`]: e.target.value})} />
                                    <input placeholder={`Channel ${i} Link`} className="input-field" value={settings[`chan${i}Url`] || ''} onChange={e => setSettings({...settings, [`chan${i}Url`]: e.target.value})} />
                                </div>
                            ))}
                        </div>
                        <div className="card p-4 space-y-3">
                            <p className="text-[9px] font-black text-slate-600 uppercase">Task Factory</p>
                            <div className="grid grid-cols-4 gap-2">
                                <input placeholder="Icon" className="input-field" value={newTask.icon} onChange={e => setNewTask({...newTask, icon: e.target.value})} />
                                <input placeholder="Title" className="input-field col-span-3" value={newTask.title} onChange={e => setNewTask({...newTask, title: e.target.value})} />
                            </div>
                            <input type="number" placeholder="Reward Amount" className="input-field" value={newTask.reward} onChange={e => setNewTask({...newTask, reward: Number(e.target.value)})} />
                            <textarea placeholder="Instructions" className="input-field h-16" value={newTask.description} onChange={e => setNewTask({...newTask, description: e.target.value})} />
                            <input placeholder="Action URL" className="input-field" value={newTask.link} onChange={e => setNewTask({...newTask, link: e.target.value})} />
                            <button onClick={async () => { if(!newTask.title) return; const id = 't_' + Date.now(); await db.ref(`tasks/${id}`).set({ ...newTask, id }); setNewTask({ icon: 'üéØ', title: '', reward: 100, description: '', link: '' }); showToast("Task Deployed", "üöÄ"); }} className="btn-primary">CREATE TASK</button>
                        </div>
                        <div className="space-y-2">
                            {tasks.map(t => (
                                <div key={t.id} className="card p-3 flex justify-between items-center text-[10px] font-bold">
                                    <span>{t.icon} {t.title}</span>
                                    <button onClick={() => db.ref(`tasks/${t.id}`).remove()} className="text-red-500">REMOVE</button>
                                </div>
                            ))}
                        </div>
                        <button onClick={save} className="btn-primary h-12">COMMIT CHANGES</button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [tab, setTab] = useState('home');
            const [tasks, setTasks] = useState([]);
            const [config, setConfig] = useState({ appName: 'EarnHub', minWithdrawal: 1000, referralReward: 500, currency: '‚Ç¶', adminPin: '2025', devPin: '5050' });
            const [showAdmin, setShowAdmin] = useState(false);
            const [showDev, setShowDev] = useState(false);
            const [showPinModal, setShowPinModal] = useState(null);
            const [gate, setGate] = useState(false);
            const [joinGate, setJoinGate] = useState(false);
            const [adminTaps, setAdminTaps] = useState(0);
            const [devTaps, setDevTaps] = useState(0);

            useEffect(() => {
                const uid = tg?.initDataUnsafe?.user?.id?.toString() || localStorage.getItem('eh_uid') || 'u_'+Math.random().toString(36).substr(2, 9);
                localStorage.setItem('eh_uid', uid);
                db.ref('config/app').on('value', s => {
                    const c = s.exists() ? {...config, ...s.val()} : config;
                    setConfig(c);
                    db.ref(`users/${uid}`).on('value', us => {
                        if(us.exists()) { 
                            const u = us.val();
                            setUser(u); setGate(false); setJoinGate(!u.joined);
                            } else { setGate(true); }
                        setLoading(false);
                    });
                });
                db.ref('tasks').on('value', s => setTasks(s.exists() ? Object.values(s.val()) : []));
                return () => db.ref().off();
            }, []);

            const verifyPin = (pin) => {
                if (showPinModal === 'admin') {
                    if (pin === config.adminPin) { setShowAdmin(true); setShowPinModal(null); }
                    else { showToast("Invalid Admin PIN", "‚ùå"); }
                } else if (showPinModal === 'dev') {
                    if (pin === config.devPin) { setShowDev(true); setShowPinModal(null); }
                    else { showToast("Invalid Dev PIN", "‚ùå"); }
                }
            };

            if(loading) return <div className="fixed inset-0 flex items-center justify-center bg-[#0c0f16]"><div className="w-8 h-8 border-4 border-[var(--accent)] border-t-transparent rounded-full animate-spin"></div></div>;

            if(gate) return (
                <div className="fixed inset-0 bg-[#0c0f16] p-10 flex flex-col items-center justify-center text-center">
                    <div className="w-20 h-20 rounded-[32px] bg-[var(--accent)]/10 text-[var(--accent)] flex items-center justify-center text-5xl mb-8">üí∞</div>
                    <h2 className="text-2xl font-black mb-3 italic tracking-tighter">Welcome to {config.appName}</h2>
                    <p className="text-slate-500 mb-10 text-[11px] font-medium opacity-70">The ultimate hub for micro-tasks and fast rewards.</p>
                    <button onClick={async () => {
                        const uid = localStorage.getItem('eh_uid');
                        const start = tg?.initDataUnsafe?.start_param;
                        const newUser = { uid, username: tg?.initDataUnsafe?.user?.username || 'user_'+uid.slice(-4), points: 0, referrals: 0, joined: false };
                        if(start && start.startsWith('u_')) {
                            db.ref(`users/${start}`).transaction(u => { 
                                if(u) { u.points = (u.points || 0) + (config.referralReward || 500); u.referrals = (u.referrals || 0) + 1; } 
                                return u; 
                            });
                        }
                        await db.ref(`users/${uid}`).set(newUser);
                    }} className="btn-primary h-14">ENTER HUB</button>
                </div>
            );

            if(joinGate) return (
                <div className="fixed inset-0 bg-[#0c0f16] p-8 flex flex-col items-center justify-center text-center z-[9000]">
                    <h2 className="text-xl font-black mb-4 uppercase tracking-tighter">Community Check</h2>
                    <p className="text-slate-500 text-[10px] mb-8 uppercase font-black opacity-60 tracking-widest leading-loose">Follow our channels to unlock access</p>
                    <div className="w-full space-y-3 mb-10">
                        {[1, 2, 3].map(i => config[`chan${i}Url`] && (
                            <button key={i} onClick={() => window.open(config[`chan${i}Url`], '_blank')} className="w-full py-3 bg-white/5 rounded-xl border border-white/10 text-[11px] font-black uppercase italic">
                                üîó JOIN {config[`chan${i}Name`] || `CHANNEL ${i}`}
                            </button>
                        ))}
                    </div>
                    <button onClick={async () => { await db.ref(`users/${user.uid}/joined`).set(true); showToast("Welcome!", "‚úÖ"); }} className="btn-primary h-14">VERIFIED - LET'S GO</button>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24">
                    {showPinModal && <PinModal title={showPinModal === 'admin' ? "Admin Lock" : "Developer Lock"} onConfirm={verifyPin} onCancel={() => setShowPinModal(null)} />}
                    {showAdmin && <AdminPanel onExit={() => setShowAdmin(false)} config={config} tasks={tasks} />}
                    {showDev && <DevPanel onExit={() => setShowDev(false)} config={config} />}

                    <header className="px-4 py-5 flex justify-between items-center sticky top-0 bg-[#0c0f16]/90 backdrop-blur-xl z-40 border-b border-white/5">
                        <div className="flex items-center gap-2" onClick={() => { setAdminTaps(t => t + 1); if(adminTaps + 1 >= 20) { setAdminTaps(0); setShowPinModal('admin'); } }}>
                            <div className="w-10 h-10 rounded-xl bg-[var(--accent)] text-black flex items-center justify-center font-black text-lg active:scale-90 transition-transform">{user?.username?.[0].toUpperCase()}</div>
                            <div>
                                <h1 className="font-black text-xs tracking-tight italic">@{user?.username}</h1>
                                <p className="text-[8px] text-slate-500 font-black uppercase tracking-widest opacity-40">Pro Member</p>
                            </div>
                        </div>
                        <div onClick={() => { setDevTaps(t => t + 1); if(devTaps + 1 >= 50) { setDevTaps(0); setShowPinModal('dev'); } }} className="bg-white/5 px-3 py-2 rounded-full border border-white/10 text-[8px] font-black uppercase text-slate-400 active:bg-white/10">ID: {user?.uid.slice(-4)}</div>
                    </header>

                    <main className="px-4 space-y-5 pt-5">
                        {tab === 'home' && (
                            <div className="space-y-5 animate-slide">
                                <div className="card p-8 text-center bg-gradient-to-br from-[#1c2230] to-[#161b26] border-white/10 shadow-2xl">
                                    <p className="text-[9px] font-black text-slate-600 uppercase tracking-[0.3em] mb-3">Your Earnings</p>
                                    <h2 className="text-5xl font-black tracking-tighter italic">{user?.points.toLocaleString()} <span className="text-lg opacity-20 font-normal ml-1">{config.currency}</span></h2>
                                    <div className="flex justify-center gap-10 mt-8">
                                        <div className="text-center"><p className="text-xl font-black italic">{tasks.length}</p><p className="text-[8px] uppercase font-black text-slate-500 tracking-[0.2em] opacity-40">Tasks</p></div>
                                        <div className="w-px h-8 bg-white/5"></div>
                                        <div className="text-center"><p className="text-xl font-black italic">{user?.referrals || 0}</p><p className="text-[8px] uppercase font-black text-slate-500 tracking-[0.2em] opacity-40">Recruits</p></div>
                                    </div>
                                </div>
                                <button onClick={() => setTab('tasks')} className="btn-primary h-14 shadow-lg shadow-[var(--accent)]/10">START EARNING</button>
                            </div>
                        )}
                        {tab === 'tasks' && (
                            <div className="animate-slide pb-10">
                                <h3 className="text-[9px] font-black text-slate-600 uppercase tracking-[0.3em] mb-4 ml-1">Live Ops</h3>
                                {tasks.length === 0 ? <p className="text-center py-10 opacity-20 uppercase font-black text-[10px] tracking-widest italic">No missions available</p> : tasks.map(t => <TaskCard key={t.id} task={t} user={user} currency={config.currency} config={config} />)}
                            </div>
                        )}
                        {tab === 'wallet' && (
                            <div className="space-y-5 animate-slide">
                                <div className="card p-6 text-center border-white/10 glass">
                                    <p className="text-[9px] font-black text-slate-500 uppercase tracking-[0.3em] mb-2 opacity-50">Current Balance</p>
                                    <h2 className="text-4xl font-black italic tracking-tighter">{user?.points.toLocaleString()} {config.currency}</h2>
                                </div>
                                <div className="card p-5 space-y-3 bg-black/20">
                                    <p className="text-[9px] font-black uppercase text-slate-600 tracking-widest mb-2">Cash Out</p>
                                    <input type="number" id="wAmt" className="input-field" placeholder={`Min: ${config.minWithdrawal}`} />
                                    <input id="wBank" className="input-field" placeholder="Target Bank" />
                                    <input id="wAcc" className="input-field" placeholder="Account Number (10 digits)" maxLength={10} />
                                    <button onClick={async (e) => {
                                        const amt = Number(document.getElementById('wAmt').value);
                                        const b = document.getElementById('wBank').value;
                                        const a = document.getElementById('wAcc').value;
                                        if(amt < config.minWithdrawal || amt > user.points || !b || a.length < 10) return showToast("Check details/balance", "‚ùå");
                                        e.currentTarget.disabled = true;
                                        try {
                                            await sendToTelegram('payout', { uid: user.uid, username: user.username, amount: amt, bankName: b, accountNumber: a }, config);
                                            await db.ref(`users/${user.uid}/points`).transaction(p => (p || 0) - amt);
                                            showToast("Cash Out Requested!", "üè¶");
                                            document.querySelectorAll('.input-field').forEach(i => i.value = '');
                                        } catch(e) { showToast(`FAILED: ${e.message}`, "‚ö†Ô∏è"); }
                                        finally { e.currentTarget.disabled = false; }
                                    }} className="btn-primary h-14">SUBMIT PAYOUT</button>
                                </div>
                                {config.publicPayouts && (
                                    <button onClick={() => window.open(`https://t.me/${config.publicPayouts.replace('@', '')}`, '_blank')} className="w-full py-3 bg-white/5 rounded-xl border border-white/10 text-[9px] font-black uppercase text-slate-400 flex items-center justify-center gap-2">
                                        üí∏ View Payout History Channel
                                    </button>
                                )}
                            </div>
                        )}
                        {tab === 'invite' && (
                            <div className="text-center pt-10 animate-slide px-4">
                                <div className="w-24 h-24 bg-[var(--accent)]/5 rounded-[40px] flex items-center justify-center mx-auto mb-8 shadow-inner border border-white/5"> <span className="text-5xl">üéÅ</span> </div>
                                <h3 className="text-3xl font-black mb-3 tracking-tighter italic">Expand Hub</h3>
                                <p className="text-slate-500 mb-10 text-[11px] leading-relaxed font-bold opacity-60">Recruit friends and gain <span className="text-[var(--accent)] font-black">+{config.referralReward} {config.currency}</span> per verified signup.</p>
                                <button onClick={() => { const link = `https://t.me/${config.botUsername}/${config.appShortName}?startapp=u_${user?.uid}`; navigator.clipboard.writeText(link); showToast("Recruit Link Copied", "üìã"); }} className="btn-primary h-16 text-xs font-black tracking-widest italic">COPY RECRUIT LINK</button>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-6 left-6 right-6 h-16 nav-pill rounded-[24px] flex items-center justify-around z-50 border border-white/5 shadow-2xl">
                        {[
                            { id: 'home', icon: 'üè†', label: 'Home' },
                            { id: 'tasks', icon: 'üéØ', label: 'Earn' },
                            { id: 'invite', icon: 'ü§ù', label: 'Invite' },
                            { id: 'wallet', icon: 'üè¶', label: 'Wallet' }
                        ].map(t => (
                            <button key={t.id} onClick={() => setTab(t.id)} className={`flex flex-col items-center gap-1 transition-all ${tab === t.id ? 'text-[var(--accent)] scale-110' : 'text-slate-500 opacity-30 hover:opacity-100'}`}>
                                <span className="text-xl mb-0.5">{t.icon}</span>
                                <span className="text-[7px] font-black uppercase tracking-widest italic">{t.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
    
